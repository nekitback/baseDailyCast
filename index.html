<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Base Mini App â€“ Daily Cast</title>

  <!-- Mobile first -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- ethers.js -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.8.1/dist/ethers.umd.min.js"></script>

  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      background: #0b0f1a;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .card {
      width: 90%;
      max-width: 360px;
      background: #141a2e;
      border-radius: 16px;
      padding: 24px;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    }

    h1 {
      margin-top: 0;
      font-size: 22px;
    }

    button {
      width: 100%;
      padding: 14px;
      margin-top: 12px;
      border-radius: 12px;
      border: none;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
    }

    .primary {
      background: #0052ff;
      color: #fff;
    }

    .secondary {
      background: #1f2a4a;
      color: #fff;
    }

    .status {
      margin-top: 16px;
      font-size: 14px;
      opacity: 0.9;
      min-height: 20px;
    }
  </style>
</head>
<body>

  <div class="card">
    <h1>ðŸŽ£ Daily Cast</h1>
    <p>Cast once per day on Base</p>

    <button class="primary" onclick="connectWallet()">
      Connect Wallet
    </button>

    <button class="secondary" onclick="cast()" id="castBtn" disabled>
      Cast (0.0001 ETH)
    </button>

    <div class="status" id="status"></div>
  </div>

<script>
  let provider;
  let signer;

  const BASE_CHAIN_ID = "0x2105"; // 8453

  function setStatus(text) {
    document.getElementById("status").innerText = text;
  }

  async function connectWallet() {
    if (!window.ethereum) {
      alert("Open in Coinbase Wallet or install MetaMask");
      return;
    }

    try {
      setStatus("Connecting wallet...");

      provider = new ethers.BrowserProvider(window.ethereum);
      await provider.send("eth_requestAccounts", []);
      signer = await provider.getSigner();

      await switchToBase();

      const address = await signer.getAddress();
      setStatus("Connected: " + address.slice(0, 6) + "..." + address.slice(-4));

      document.getElementById("castBtn").disabled = false;
    } catch (err) {
      console.error(err);
      setStatus("Connection failed");
    }
  }

  async function switchToBase() {
    try {
      await window.ethereum.request({
        method: "wallet_switchEthereumChain",
        params: [{ chainId: BASE_CHAIN_ID }],
      });
    } catch (err) {
      if (err.code === 4902) {
        await window.ethereum.request({
          method: "wallet_addEthereumChain",
          params: [{
            chainId: BASE_CHAIN_ID,
            chainName: "Base",
            rpcUrls: ["https://mainnet.base.org"],
            nativeCurrency: {
              name: "Ether",
              symbol: "ETH",
              decimals: 18
            },
            blockExplorerUrls: ["https://basescan.org"]
          }]
        });
      } else {
        throw err;
      }
    }
  }

  async function cast() {
    if (!signer) return;

    try {
      setStatus("Sending transaction...");

      const tx = await signer.sendTransaction({
        to: "0x0648a08c0542d70fd7f8378a9cc2857055bfb3fb", // 
        value: ethers.parseEther("0.0001")
      });

      setStatus("Pending...");
      await tx.wait();

      setStatus("ðŸŽ‰ Cast successful!");
    } catch (err) {
      console.error(err);
      setStatus("Transaction cancelled");
    }
  }
</script>

</body>
</html>
